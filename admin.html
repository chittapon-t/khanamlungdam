<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin - ‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Kanit', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 80px; 
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .tab-active { color: #10b981; border-top: 3px solid #10b981; }
        .card-pending { border-left: 5px solid #f59e0b; }
        .card-confirmed { border-left: 5px solid #10b981; }
        .card-cancelled { border-left: 5px solid #ef4444; }
        .setting-card { background: white; border-radius: 1rem; padding: 1rem; margin-bottom: 1rem; border: 1px solid #f3f4f6; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Loading Overlay -->
    <div id="loading" class="fixed inset-0 bg-black/60 z-[100] flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-2xl shadow-2xl text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-4 border-emerald-600 border-t-transparent mx-auto"></div>
            <p class="mt-4 font-medium text-emerald-900">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-emerald-900 text-white px-4 py-4 sticky top-0 z-40 shadow-md">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="font-bold text-lg" id="headerTitle">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h1>
                <p class="text-[10px] text-emerald-300 opacity-80" id="lastUpdate">‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥ ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</p>
            </div>
            <button onclick="fetchData()" class="p-2 bg-emerald-800 rounded-full active:scale-90 transition-transform">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
            </button>
        </div>
    </header>

    <main class="p-4 max-w-lg mx-auto">
        
        <!-- Tab: DASHBOARD -->
        <section id="tab-upcoming" class="tab-content space-y-4">
            <!-- Stats -->
            <div class="flex space-x-3 overflow-x-auto pb-2 no-scrollbar">
                <div class="min-w-[140px] bg-white p-4 rounded-2xl shadow-sm border border-emerald-100">
                    <p class="text-xs text-gray-500 mb-1">‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                    <p id="statToday" class="text-2xl font-bold text-emerald-600">0</p>
                </div>
                <div class="min-w-[140px] bg-white p-4 rounded-2xl shadow-sm border border-orange-100">
                    <p class="text-xs text-gray-500 mb-1">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏•‡∏¥‡∏õ</p>
                    <p id="statPending" class="text-2xl font-bold text-orange-500">0</p>
                </div>
                <div class="min-w-[140px] bg-white p-4 rounded-2xl shadow-sm border border-blue-100">
                    <p class="text-xs text-gray-500 mb-1">‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    <p id="statRevenue" class="text-2xl font-bold text-blue-600">‡∏ø0</p>
                </div>
            </div>

            <!-- Upcoming List Section -->
            <div class="mt-2">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="font-bold text-emerald-900 flex items-center">
                        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏à‡∏∞‡∏ñ‡∏∂‡∏á
                    </h2>
                    <span class="text-[10px] bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full font-bold">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
                </div>
                <div id="upcomingCards" class="space-y-3">
                    <!-- Cards will be injected here -->
                    <div class="text-center py-10 text-gray-400 text-sm italic">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</div>
                </div>
            </div>
        </section>

        <!-- Tab: ALL BOOKINGS -->
        <section id="tab-bookings" class="tab-content hidden space-y-4">
            <div class="relative">
                <input type="text" id="searchBooking" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á..." class="w-full pl-10 pr-4 py-3 rounded-2xl border-none shadow-sm focus:ring-2 focus:ring-emerald-500" onkeyup="renderCards()">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-3.5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
            </div>
            <div id="allBookingCards" class="space-y-3"></div>
        </section>

        <!-- Tab: SETTINGS -->
        <section id="tab-settings" class="tab-content hidden animate-fade-in">
            <!-- Special Days Setting -->
            <div class="setting-card shadow-sm">
                <h3 class="font-bold text-emerald-900 flex items-center mb-4 text-sm">
                    <svg class="w-4 h-4 mr-2 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                    ‡∏ß‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏°‡∏±‡∏î‡∏à‡∏≥ 100%)
                </h3>
                <div class="flex space-x-2 mb-4">
                    <input type="date" id="newSpecialDate" class="flex-1 border rounded-xl p-2.5 text-sm focus:ring-2 focus:ring-emerald-500 outline-none">
                    <button onclick="addSpecialDate()" class="bg-emerald-600 text-white px-5 py-2.5 rounded-xl text-sm font-bold active:scale-95 transition-all">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>
                <div id="specialDateList" class="flex flex-wrap gap-2"></div>
            </div>

            <!-- Promo Code Setting -->
            <div class="setting-card shadow-sm">
                <h3 class="font-bold text-emerald-900 flex items-center mb-4 text-sm">
                    <svg class="w-4 h-4 mr-2 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" /></svg>
                    ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (Promo Codes)
                </h3>
                <div class="space-y-3">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="text" id="promoCode" placeholder="‡πÇ‡∏Ñ‡πâ‡∏î (‡πÄ‡∏ä‡πà‡∏ô SALE10)" class="border rounded-xl p-2.5 text-sm uppercase outline-none">
                        <select id="promoType" class="border rounded-xl p-2.5 text-sm outline-none">
                            <option value="baht">‡∏•‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏≤‡∏ó (‡∏ø)</option>
                            <option value="percent">‡∏•‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå (%)</option>
                        </select>
                    </div>
                    <div class="flex space-x-2">
                        <input type="number" id="promoValue" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏î" class="flex-1 border rounded-xl p-2.5 text-sm outline-none">
                        <button onclick="addPromoCode()" class="bg-blue-600 text-white px-5 py-2.5 rounded-xl text-sm font-bold active:scale-95 transition-all">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    </div>
                </div>
                <div id="promoCodeList" class="mt-4 space-y-2"></div>
            </div>
        </section>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 px-6 py-2 flex justify-around items-center z-50 shadow-[0_-2px_10px_rgba(0,0,0,0.05)]">
        <button onclick="switchTab('upcoming', '‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î')" id="nav-upcoming" class="flex flex-col items-center space-y-1 transition-all tab-active">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
            <span class="text-[10px] font-medium">Dashboard</span>
        </button>
        <button onclick="switchTab('bookings', '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')" id="nav-bookings" class="flex flex-col items-center space-y-1 text-gray-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" /></svg>
            <span class="text-[10px] font-medium">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</span>
        </button>
        <button onclick="switchTab('settings', '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö')" id="nav-settings" class="flex flex-col items-center space-y-1 text-gray-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" /></svg>
            <span class="text-[10px] font-medium">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
        </button>
    </nav>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwb9VWt0rQYJ2dJa9jQKM23YRKsx-YReKnqJTiqGRbg26jEMtPP-RzxDbe_BahxUiSu5g/exec"; 
        
        let allData = [];
        let specialDates = []; 
        let promoCodes = []; 

        function switchTab(tab, title) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById(`tab-${tab}`).classList.remove('hidden');
            document.getElementById('headerTitle').innerText = title;
            
            document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('tab-active', 'text-gray-400'));
            document.getElementById(`nav-${tab}`).classList.add('tab-active');
            window.scrollTo(0,0);
        }

        async function fetchData() {
            document.getElementById('loading').classList.remove('hidden');
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏à‡∏≤‡∏Å Sheet
                allData = data.bookings || data; 
                specialDates = data.specialDates || [];
                promoCodes = data.promoCodes || [];

                updateStats();
                renderCards();
                renderSettings();
            } catch (err) {
                console.error(err);
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        function updateStats() {
            const todayStr = new Date().toISOString().split('T')[0];
            const todayBookings = allData.filter(i => i.CheckIn && i.CheckIn.split('T')[0] === todayStr).length;
            const pending = allData.filter(i => i.Status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö').length;
            const revenue = allData.filter(i => i.Status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß').reduce((sum, i) => sum + Number(i.Deposit || 0), 0);

            document.getElementById('statToday').innerText = todayBookings;
            document.getElementById('statPending').innerText = pending;
            document.getElementById('statRevenue').innerText = `‡∏ø${revenue.toLocaleString()}`;
        }

        function renderCards() {
            const query = document.getElementById('searchBooking').value.toLowerCase();
            const today = new Date();
            today.setHours(0,0,0,0);

            // 1. Render Upcoming (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á)
            const upcomingContainer = document.getElementById('upcomingCards');
            const upcomingBookings = allData
                .filter(i => {
                    const checkInDate = new Date(i.CheckIn);
                    return i.Status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' && checkInDate >= today;
                })
                .sort((a, b) => new Date(a.CheckIn) - new Date(b.CheckIn))
                .slice(0, 15); // ‡πÅ‡∏™‡∏î‡∏á 15 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            
            if (upcomingBookings.length > 0) {
                upcomingContainer.innerHTML = upcomingBookings.map(item => createBookingCard(item, false)).join('');
            } else {
                upcomingContainer.innerHTML = '<div class="text-center py-10 text-gray-400 text-sm italic">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</div>';
            }

            // 2. Render All (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏á)
            const allContainer = document.getElementById('allBookingCards');
            const filteredAll = allData.filter(i => 
                (i.CustomerName || "").toLowerCase().includes(query) || 
                (i.BookingID || "").toLowerCase().includes(query)
            ).sort((a, b) => new Date(b.CheckIn) - new Date(a.CheckIn)); // ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÄ‡∏≠‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô

            allContainer.innerHTML = filteredAll.map(item => createBookingCard(item)).join('');
        }

        function createBookingCard(item, showActions = true) {
            const statusClass = item.Status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' ? 'card-confirmed' : (item.Status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö' ? 'card-pending' : 'card-cancelled');
            const badge = item.Status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' ? 'bg-emerald-100 text-emerald-700' : 'bg-orange-100 text-orange-700';
            
            const cin = new Date(item.CheckIn);
            const dateStr = cin.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: '2-digit' });
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const today = new Date();
            const isToday = cin.getDate() === today.getDate() && cin.getMonth() === today.getMonth() && cin.getFullYear() === today.getFullYear();

            return `
                <div class="bg-white rounded-2xl shadow-sm p-4 ${statusClass} border border-gray-100 animate-fade-in relative overflow-hidden">
                    ${isToday ? '<div class="absolute top-0 right-0 bg-red-500 text-white text-[8px] font-bold px-2 py-0.5 rounded-bl-lg uppercase">Today</div>' : ''}
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <p class="text-[9px] text-gray-400 font-bold uppercase tracking-wider">${item.BookingID}</p>
                            <h3 class="font-bold text-gray-800">${item.CustomerName}</h3>
                        </div>
                        <span class="px-2 py-0.5 rounded text-[10px] font-bold ${badge}">${item.Status}</span>
                    </div>
                    <div class="flex items-center text-xs text-gray-600 mb-4 bg-gray-50 p-2 rounded-lg">
                        <div class="mr-4">
                            <p class="text-[9px] text-gray-400 uppercase">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å</p>
                            <p class="font-bold text-emerald-800">üìÖ ${dateStr}</p>
                        </div>
                        <div class="border-l pl-4">
                            <p class="text-[9px] text-gray-400 uppercase">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡πâ‡∏≠‡∏á</p>
                            <p class="font-medium truncate max-w-[120px]">üè† ${item.RoomsInfo}</p>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-[9px] text-gray-400 uppercase">‡∏°‡∏±‡∏î‡∏à‡∏≥‡πÅ‡∏•‡πâ‡∏ß</p>
                            <p class="text-sm font-bold text-emerald-700">‡∏ø${Number(item.Deposit).toLocaleString()}</p>
                        </div>
                        <div class="flex space-x-2">
                            <a href="tel:${item.Phone}" class="flex items-center justify-center w-9 h-9 bg-blue-50 text-blue-600 rounded-xl active:scale-90 transition-all">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 005.47 5.47l.772-1.547a1 1 0 011.06-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/></svg>
                            </a>
                            ${item.Status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö' ? `
                                <button onclick="updateStatus('${item.BookingID}', '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß')" class="bg-emerald-600 text-white px-4 py-1 rounded-xl text-xs font-bold active:scale-95">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏•‡∏¥‡∏õ</button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ (Settings) ---

        function renderSettings() {
            const dateList = document.getElementById('specialDateList');
            dateList.innerHTML = specialDates.map(date => `
                <div class="bg-emerald-50 text-emerald-800 border border-emerald-200 px-3 py-1.5 rounded-xl text-xs font-bold flex items-center animate-fade-in">
                    ${new Date(date).toLocaleDateString('th-TH')}
                    <button onclick="removeSpecialDate('${date}')" class="ml-2 text-emerald-400 hover:text-red-500 transition-colors text-lg">&times;</button>
                </div>
            `).join('');

            const promoList = document.getElementById('promoCodeList');
            promoList.innerHTML = promoCodes.map(p => `
                <div class="flex justify-between items-center p-3 bg-white rounded-xl border border-gray-100 shadow-sm animate-fade-in">
                    <div>
                        <span class="font-bold text-emerald-800 bg-emerald-50 px-2 py-0.5 rounded text-[10px] mr-2">${p.code}</span>
                        <span class="text-xs text-gray-600">${p.type === 'baht' ? `‡∏•‡∏î ‡∏ø${p.value}` : `‡∏•‡∏î ${p.value}%`}</span>
                    </div>
                    <button onclick="removePromoCode('${p.code}')" class="text-red-400 hover:text-red-600 p-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                    </button>
                </div>
            `).join('');
        }

        async function saveConfig(action, payload) {
            document.getElementById('loading').classList.remove('hidden');
            try {
                await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action, ...payload })
                });
                fetchData(); 
            } catch (err) { alert('‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß'); }
            finally { document.getElementById('loading').classList.add('hidden'); }
        }

        async function updateStatus(bookingId, newStatus) {
            if(!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô "${newStatus}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) return;
            saveConfig('updateStatus', { bookingId, status: newStatus });
        }

        function addSpecialDate() {
            const date = document.getElementById('newSpecialDate').value;
            if(!date) return;
            saveConfig('addSpecialDate', { date });
        }

        function removeSpecialDate(date) {
            if(!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ß‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ô‡∏µ‡πâ?')) return;
            saveConfig('removeSpecialDate', { date });
        }

        function addPromoCode() {
            const code = document.getElementById('promoCode').value.toUpperCase();
            const type = document.getElementById('promoType').value;
            const value = document.getElementById('promoValue').value;
            if(!code || !value) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î');
            saveConfig('addPromoCode', { code, type, value });
        }

        function removePromoCode(code) {
            if(!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ô‡∏µ‡πâ?')) return;
            saveConfig('removePromoCode', { code });
        }

        window.onload = fetchData;
    </script>
</body>
</html>
