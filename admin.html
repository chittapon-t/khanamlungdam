<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô - ‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- FullCalendar -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <style>
        body { font-family: 'Kanit', sans-serif; padding-bottom: 90px; }
        .tab-active { color: #059669; border-top: 3px solid #059669; background: #f0fdf4; }
        .card-confirmed { border-left: 6px solid #10b981; }
        .card-pending { border-left: 6px solid #f59e0b; }
        .animate-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #calendar { background: white; border-radius: 1.5rem; padding: 15px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        .fc-toolbar-title { font-size: 1.1rem !important; font-weight: bold; color: #064e3b; }
        .fc-button { background: #065f46 !important; border: none !important; font-size: 0.8rem !important; }
        ::-webkit-scrollbar { display: none; }
        .stat-card { transition: transform 0.2s; }
        .stat-card:active { transform: scale(0.95); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <!-- Loading Overlay -->
    <div id="loading" class="fixed inset-0 bg-black/70 z-[100] flex items-center justify-center hidden backdrop-blur-sm">
        <div class="bg-white p-8 rounded-3xl text-center shadow-2xl">
            <div class="animate-spin rounded-full h-12 w-12 border-4 border-emerald-600 border-t-transparent mx-auto"></div>
            <p class="mt-4 font-bold text-emerald-900">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-emerald-900 text-white p-5 sticky top-0 z-40 shadow-xl flex justify-between items-center rounded-b-[2rem]">
        <div>
            <h1 class="font-bold text-xl" id="headerTitle">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h1>
            <p class="text-[10px] text-emerald-300 tracking-widest uppercase opacity-80">Management System v2.6</p>
        </div>
        <button onclick="fetchData()" class="p-3 bg-emerald-800 rounded-2xl active:scale-90 transition-all">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" stroke-width="2.5" stroke-linecap="round"/></svg>
        </button>
    </header>

    <main class="p-4 max-w-2xl mx-auto min-h-screen">
        
        <!-- Section: ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î (Dashboard Overview) -->
        <section id="tab-home" class="tab-content hidden animate-in space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100 stat-card">
                    <p class="text-xs text-slate-400 font-bold uppercase">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                    <h2 id="stat-today-bookings" class="text-3xl font-bold text-emerald-700 mt-1">0</h2>
                </div>
                <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100 stat-card">
                    <p class="text-xs text-slate-400 font-bold uppercase">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
                    <h2 id="stat-pending-bookings" class="text-3xl font-bold text-orange-500 mt-1">0</h2>
                </div>
                <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100 stat-card col-span-2">
                    <p class="text-xs text-slate-400 font-bold uppercase">‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏£‡∏ß‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>
                    <h2 id="stat-monthly-revenue" class="text-3xl font-bold text-slate-800 mt-1">‡∏ø0</h2>
                </div>
            </div>

            <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à -->
            <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
                <h3 class="font-bold text-emerald-900 mb-4 flex items-center justify-between">
                    <span>‚è≥ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>
                    <button onclick="switchTab('bookings', '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')" class="text-xs text-emerald-600">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ></button>
                </h3>
                <div id="quick-pending-list" class="space-y-3">
                    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÉ‡∏™‡πà‡∏î‡πâ‡∏ß‡∏¢ JS -->
                </div>
            </div>
        </section>

        <!-- Section: ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô -->
        <section id="tab-calendar" class="tab-content hidden animate-in">
            <div id="calendar" class="mb-4"></div>
            <div class="bg-white p-4 rounded-2xl border border-slate-200 flex justify-around text-xs font-bold">
                <div class="flex items-center"><span class="w-3 h-3 bg-emerald-500 rounded-full mr-2"></span> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</div>
                <div class="flex items-center"><span class="w-3 h-3 bg-orange-400 rounded-full mr-2"></span> ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
            </div>
        </section>

        <!-- Section: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
        <section id="tab-bookings" class="tab-content hidden space-y-4 animate-in">
            <div class="relative group">
                <input type="text" id="searchBooking" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡πÄ‡∏ö‡∏≠‡∏£‡πå, ID ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á..." 
                       class="w-full p-4 pl-12 rounded-2xl border-none shadow-inner bg-white focus:ring-2 focus:ring-emerald-500 transition-all"
                       onkeyup="renderCards()">
                <svg class="w-6 h-6 absolute left-4 top-4 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-width="2"/></svg>
            </div>
            <div id="allBookingCards" class="space-y-4"></div>
        </section>

        <!-- Section: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ -->
        <section id="tab-settings" class="tab-content hidden space-y-6 animate-in">
            <!-- Promo Codes -->
            <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
                <h3 class="font-bold text-emerald-900 mb-4 flex items-center">
                    <span class="mr-2 text-xl">üéüÔ∏è</span> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î
                </h3>
                <div class="space-y-3">
                    <input type="text" id="promoCode" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÇ‡∏Ñ‡πâ‡∏î (‡πÄ‡∏ä‡πà‡∏ô SUMMER20)" class="w-full bg-slate-50 p-3 rounded-xl border-none focus:ring-2 focus:ring-emerald-500">
                    <div class="flex gap-2">
                        <input type="number" id="promoValue" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" class="flex-1 bg-slate-50 p-3 rounded-xl border-none">
                        <select id="promoType" class="w-24 bg-slate-50 p-3 rounded-xl border-none font-bold text-emerald-700">
                            <option value="‡∏ö‡∏≤‡∏ó">‡∏ö‡∏≤‡∏ó</option>
                            <option value="%">%</option>
                        </select>
                    </div>
                    <button onclick="addPromoCode()" class="w-full bg-emerald-700 text-white py-4 rounded-xl font-bold shadow-lg shadow-emerald-100 active:scale-95 transition-all">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡∏°‡πà</button>
                </div>
                <div id="promoList" class="mt-6 space-y-2 border-t pt-4"></div>
            </div>

            <!-- Special Dates -->
            <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
                <h3 class="font-bold text-emerald-900 mb-4 flex items-center">
                    <span class="mr-2 text-xl">üìÖ</span> ‡∏ß‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏°‡∏±‡∏î‡∏à‡∏≥ 100%)
                </h3>
                <div class="flex gap-2 mb-4">
                    <input type="date" id="newSpecialDate" class="flex-1 bg-slate-50 p-3 rounded-xl border-none">
                    <button onclick="addSpecialDate()" class="bg-emerald-600 text-white px-6 rounded-xl font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>
                <div id="specialDateList" class="flex flex-wrap gap-2"></div>
            </div>
        </section>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-md border-t border-slate-100 p-2 flex justify-around z-50">
        <button onclick="switchTab('home', '‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î')" id="nav-home" class="flex-1 flex flex-col items-center py-2 transition-all rounded-2xl text-slate-400">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" stroke-width="2"/></svg>
            <span class="text-[10px] mt-1 font-bold">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span>
        </button>
        <button onclick="switchTab('calendar', '‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á')" id="nav-calendar" class="flex-1 flex flex-col items-center py-2 transition-all rounded-2xl text-slate-400">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" stroke-width="2"/></svg>
            <span class="text-[10px] mt-1 font-bold">‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</span>
        </button>
        <button onclick="switchTab('bookings', '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')" id="nav-bookings" class="flex-1 flex flex-col items-center py-2 transition-all rounded-2xl text-slate-400">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h7" stroke-width="2"/></svg>
            <span class="text-[10px] mt-1 font-bold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
        </button>
        <button onclick="switchTab('settings', '‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö')" id="nav-settings" class="flex-1 flex flex-col items-center py-2 transition-all rounded-2xl text-slate-400">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" stroke-width="2"/></svg>
            <span class="text-[10px] mt-1 font-bold">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
        </button>
    </nav>

    <script>
        // API URL (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Web App URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
        const API_URL = "https://script.google.com/macros/s/AKfycbwb9VWt0rQYJ2dJa9jQKM23YRKsx-YReKnqJTiqGRbg26jEMtPP-RzxDbe_BahxUiSu5g/exec";
        
        let allData = [];
        let specialDates = [];
        let promoCodes = [];
        let calendar = null;

        // ‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        function switchTab(tab, title) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById(`tab-${tab}`).classList.remove('hidden');
            document.getElementById('headerTitle').innerText = title;
            document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('tab-active', 'text-slate-400'));
            document.getElementById(`nav-${tab}`).classList.add('tab-active');
            
            if(tab === 'calendar') {
                setTimeout(() => {
                    if (!calendar) initCalendar();
                    calendar.render();
                    calendar.updateSize();
                }, 100);
            }
            window.scrollTo(0,0);
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
        function initCalendar() {
            calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
                initialView: 'dayGridMonth',
                locale: 'th',
                headerToolbar: { left: 'prev,next', center: 'title', right: 'today' },
                events: prepareEvents(),
                eventClick: (info) => {
                    document.getElementById('searchBooking').value = info.event.extendedProps.id;
                    switchTab('bookings', '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                    renderCards();
                }
            });
        }

        // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Event ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
        function prepareEvents() {
            return allData.filter(i => i.Status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å').map(item => {
                const start = new Date(item.CheckIn);
                const end = new Date(item.CheckOut);
                const displayEnd = new Date(end);
                displayEnd.setDate(displayEnd.getDate() + 1);
                
                return {
                    title: `[${item.Rooms}] ${item.CustomerName}`,
                    start: start.toISOString().split('T')[0],
                    end: displayEnd.toISOString().split('T')[0],
                    color: item.Status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' ? '#10b981' : '#fbbf24',
                    extendedProps: { id: item.BookingID }
                };
            });
        }

        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        async function fetchData() {
            document.getElementById('loading').classList.remove('hidden');
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                allData = data.bookings || [];
                specialDates = data.specialDates || [];
                promoCodes = data.promoCodes || [];

                allData.sort((a,b) => new Date(a.CheckIn) - new Date(b.CheckIn));

                updateStats();
                renderCards();
                renderSettings();
                if(calendar) {
                    calendar.removeAllEvents();
                    calendar.addEventSource(prepareEvents());
                }
            } catch (e) {
                console.error("Fetch Error:", e);
                alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
        function updateStats() {
            const today = new Date().toISOString().split('T')[0];
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            const todayBookings = allData.filter(i => i.CheckIn.includes(today)).length;
            const pendingBookings = allData.filter(i => i.Status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö');
            const monthlyRevenue = allData
                .filter(i => {
                    const d = new Date(i.CheckIn);
                    return d.getMonth() === currentMonth && d.getFullYear() === currentYear && i.Status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
                })
                .reduce((sum, item) => sum + Number(item.Deposit), 0);

            document.getElementById('stat-today-bookings').innerText = todayBookings;
            document.getElementById('stat-pending-bookings').innerText = pendingBookings.length;
            document.getElementById('stat-monthly-revenue').innerText = '‡∏ø' + monthlyRevenue.toLocaleString();

            // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏î‡πà‡∏ß‡∏ô
            const quickList = document.getElementById('quick-pending-list');
            if(pendingBookings.length === 0) {
                quickList.innerHTML = `<p class="text-center text-slate-400 py-4 text-xs italic">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>`;
            } else {
                quickList.innerHTML = pendingBookings.slice(0, 5).map(item => `
                    <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100">
                        <div>
                            <p class="font-bold text-sm text-slate-800">${item.CustomerName}</p>
                            <p class="text-[10px] text-slate-400">${item.Rooms} | ${new Date(item.CheckIn).toLocaleDateString('th-TH')}</p>
                        </div>
                        <button onclick="viewBookingDetail('${item.BookingID}')" class="bg-emerald-600 text-white px-3 py-1.5 rounded-lg text-[10px] font-bold">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
                    </div>
                `).join('');
            }
        }

        function viewBookingDetail(id) {
            document.getElementById('searchBooking').value = id;
            switchTab('bookings', '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
            renderCards();
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (Cards)
        function renderCards() {
            const query = document.getElementById('searchBooking').value.toLowerCase();
            const container = document.getElementById('allBookingCards');
            
            const filtered = allData.filter(i => 
                (i.CustomerName || "").toLowerCase().includes(query) || 
                (i.BookingID || "").toLowerCase().includes(query) ||
                (i.Tel || "").includes(query) ||
                (i.DisplayName || "").toLowerCase().includes(query)
            );

            if (filtered.length === 0) {
                container.innerHTML = `<div class="text-center py-20 text-slate-400 text-sm">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</div>`;
                return;
            }

            container.innerHTML = filtered.map(item => {
                let foods = [];
                try { foods = JSON.parse(item.Foods || "[]"); } catch(e) { foods = []; }
                const foodHtml = foods.map(f => `
                    <div class="flex justify-between border-b border-dashed py-1">
                        <span>${f.name}</span>
                        <span class="font-bold">x${f.qty}</span>
                    </div>
                `).join('');
                
                const cin = new Date(item.CheckIn).toLocaleDateString('th-TH', { day:'numeric', month:'short', year:'2-digit' });
                const cout = new Date(item.CheckOut).toLocaleDateString('th-TH', { day:'numeric', month:'short', year:'2-digit' });

                return `
                <div class="bg-white rounded-[2rem] p-5 shadow-sm border border-slate-100 ${item.Status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' ? 'card-confirmed' : 'card-pending'} animate-in" id="card-${item.BookingID}">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <p class="text-[10px] text-emerald-600 font-bold uppercase tracking-tighter">${item.BookingID}</p>
                            <h3 class="font-bold text-lg text-slate-800">${item.CustomerName}</h3>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-xs bg-emerald-50 text-emerald-600 px-2 py-0.5 rounded-lg font-bold">üí¨ ${item.DisplayName || '-'}</span>
                                <span class="text-xs bg-blue-50 text-blue-600 px-2 py-0.5 rounded-lg font-bold">üìû ${item.Tel || '-'}</span>
                            </div>
                        </div>
                        <span class="text-[10px] px-3 py-1 rounded-full font-bold shadow-sm ${item.Status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' ? 'bg-emerald-500 text-white' : 'bg-orange-400 text-white'}">
                            ${item.Status}
                        </span>
                    </div>
                    
                    <div class="bg-slate-50 p-4 rounded-2xl text-xs space-y-2 mb-4">
                        <div class="flex justify-between">
                            <span class="text-slate-400">‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å:</span>
                            <span class="font-bold text-emerald-900">${cin} - ${cout}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-slate-400">‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å:</span>
                            <span class="font-bold">${item.Rooms} (${item.Guests || 1} ‡∏ó‡πà‡∏≤‡∏ô)</span>
                        </div>
                        <div class="pt-2 border-t border-slate-200">
                            <p class="text-slate-400 mb-1 font-bold uppercase text-[9px]">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£:</p>
                            ${foodHtml || '<p class="italic text-slate-300">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>'}
                        </div>
                    </div>

                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-[9px] text-slate-400 uppercase font-bold">‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>
                            <p class="text-xl font-bold text-emerald-700">‡∏ø${Number(item.Deposit).toLocaleString()}</p>
                        </div>
                        <div class="flex gap-2">
                             <a href="${item.SlipURL}" target="_blank" class="bg-slate-800 text-white p-3 rounded-xl text-[10px] font-bold shadow-md">‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ</a>
                             <button onclick="reschedule('${item.BookingID}')" class="bg-blue-600 text-white p-3 rounded-xl text-[10px] font-bold shadow-md">‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô</button>
                             <button onclick="deleteItem('${item.BookingID}')" class="bg-red-500 text-white p-3 rounded-xl text-[10px] font-bold shadow-md">‡∏•‡∏ö</button>
                        </div>
                    </div>
                    ${item.Status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö' ? `
                        <button onclick="confirmBooking('${item.BookingID}')" class="w-full mt-4 bg-emerald-600 text-white py-3 rounded-xl font-bold text-sm shadow-lg shadow-emerald-100">
                            ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                        </button>
                    ` : ''}
                </div>
                `;
            }).join('');
        }

        function renderSettings() {
            const dateList = document.getElementById('specialDateList');
            dateList.innerHTML = specialDates.map(date => `
                <div class="bg-orange-50 text-orange-700 px-4 py-2 rounded-xl text-xs font-bold border border-orange-100 flex items-center">
                    <span>${new Date(date).toLocaleDateString('th-TH')}</span>
                    <button onclick="removeSetting('date', '${date}')" class="ml-2 text-orange-400 hover:text-orange-700">&times;</button>
                </div>
            `).join('');

            const pList = document.getElementById('promoList');
            pList.innerHTML = promoCodes.map(p => `
                <div class="bg-slate-50 border rounded-2xl p-4 flex justify-between items-center transition-all">
                    <div>
                        <span class="font-bold text-emerald-800">${p.code}</span>
                        <p class="text-[10px] text-slate-500">‡∏•‡∏î ${Number(p.value).toLocaleString()} ${p.type}</p>
                    </div>
                    <button onclick="removeSetting('promo', '${p.code}')" class="bg-red-100 text-red-500 p-2 rounded-lg">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" stroke-width="2"/></svg>
                    </button>
                </div>
            `).join('') || '<p class="text-xs text-slate-400 text-center py-4 italic">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</p>';
        }

        async function confirmBooking(id) {
            if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß?')) return;
            document.getElementById('loading').classList.remove('hidden');
            try {
                await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'updateStatus', bookingId: id, status: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' }) });
                fetchData();
            } catch (e) { alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'); }
        }

        async function deleteItem(id) {
            if(!confirm('üö® ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ô‡∏µ‡πâ? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ñ‡∏≤‡∏ß‡∏£')) return;
            document.getElementById('loading').classList.remove('hidden');
            try {
                await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'deleteBooking', bookingId: id }) });
                fetchData();
            } catch (e) { alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'); }
        }

        async function addPromoCode() {
            const code = document.getElementById('promoCode').value.trim().toUpperCase();
            const value = document.getElementById('promoValue').value;
            const type = document.getElementById('promoType').value;
            if(!code || !value) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
            
            document.getElementById('loading').classList.remove('hidden');
            await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'addPromo', code, value, type }) });
            document.getElementById('promoCode').value = '';
            document.getElementById('promoValue').value = '';
            fetchData();
        }

        async function addSpecialDate() {
            const date = document.getElementById('newSpecialDate').value;
            if(!date) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');
            
            document.getElementById('loading').classList.remove('hidden');
            await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'addSpecialDate', date }) });
            fetchData();
        }

        async function removeSetting(type, id) {
            if(!confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
            document.getElementById('loading').classList.remove('hidden');
            await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'removeSetting', type, id }) });
            fetchData();
        }

        function reschedule(id) {
            alert('üõ†Ô∏è ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô:\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏≤‡∏á Google Sheet ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡∏£‡∏±‡∏ö');
        }

        window.onload = () => {
            fetchData();
            switchTab('home', '‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î');
        };
    </script>
</body>
</html>
