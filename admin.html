<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô - ‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>body { font-family: 'Kanit', sans-serif; }</style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div class="flex flex-col md:flex-row h-screen">
        <!-- Sidebar -->
        <nav class="bg-[#1b4332] text-white w-full md:w-64 p-6">
            <h1 class="text-xl font-bold mb-8">Admin Panel</h1>
            <ul class="space-y-4">
                <li><button onclick="switchTab('dashboard')" class="hover:text-green-300 w-full text-left">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button></li>
                <li><button onclick="switchTab('bookings')" class="hover:text-green-300 w-full text-left">üìÖ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button></li>
                <li><button onclick="switchTab('settings')" class="hover:text-green-300 w-full text-left">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</button></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 p-6 overflow-y-auto">
            <div id="dashboard" class="tab-content">
                <h2 class="text-2xl font-bold mb-6">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏£‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô)</h2>
                <div id="latestBookings" class="grid gap-4">
                    <!-- Cards will be injected here -->
                </div>
            </div>

            <div id="bookings" class="tab-content hidden">
                <h2 class="text-2xl font-bold mb-6">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                <div class="overflow-x-auto bg-white rounded-lg shadow">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-gray-50 border-b">
                            <tr>
                                <th class="p-4">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th>
                                <th class="p-4">‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</th>
                                <th class="p-4">‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô</th>
                                <th class="p-4">‡∏´‡πâ‡∏≠‡∏á</th>
                                <th class="p-4">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</th>
                                <th class="p-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            </tr>
                        </thead>
                        <tbody id="allBookingsTable"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwb9VWt0rQYJ2dJa9jQKM23YRKsx-YReKnqJTiqGRbg26jEMtPP-RzxDbe_BahxUiSu5g/exec";

        async function fetchAdminData() {
            const resp = await fetch(WEB_APP_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'getInitialData' })
            });
            const data = await resp.json();
            renderDashboard(data.bookings);
            renderTable(data.bookings);
        }

        function renderDashboard(bookings) {
            const container = document.getElementById('latestBookings');
            const pending = bookings.filter(b => b[17] === "‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö").reverse();
            container.innerHTML = pending.map(b => `
                <div class="bg-white p-6 rounded-xl shadow-sm flex flex-col md:flex-row justify-between items-start md:items-center gap-4 border-l-8 border-yellow-500">
                    <div>
                        <p class="font-bold text-lg">${b[3]} (${b[4]})</p>
                        <p class="text-sm text-gray-500">‡∏´‡πâ‡∏≠‡∏á: ${b[5]} | ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô: ${b[14]}</p>
                        <p class="text-sm font-bold text-green-700">‡∏°‡∏±‡∏î‡∏à‡∏≥: ‡∏ø${b[12].toLocaleString()}</p>
                        <a href="${b[16]}" target="_blank" class="text-blue-500 underline text-xs">‡∏î‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</a>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="updateStatus('${b[0]}', '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß')" class="bg-green-600 text-white px-4 py-2 rounded-lg">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                        <button onclick="updateStatus('${b[0]}', '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å')" class="bg-red-500 text-white px-4 py-2 rounded-lg text-xs">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>
                </div>
            `).join('');
        }

        async function updateStatus(id, status) {
            if(!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô ${status}?`)) return;
            // logic to send status update to GAS
            alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)");
            fetchAdminData();
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        fetchAdminData();
    </script>
</body>
</html>
