<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - ขนำลุงดำ แคมป์ปิ้ง</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <nav class="bg-emerald-900 text-white p-4 shadow-md sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <h1 class="font-bold text-lg">Admin Panel - ขนำลุงดำ</h1>
            <div class="space-x-4 text-sm">
                <button onclick="showTab('bookings')" class="hover:text-emerald-300">รายการจอง</button>
                <button onclick="showTab('settings')" class="hover:text-emerald-300">ตั้งค่าระบบ</button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4">
        <!-- Dashboard / Bookings Tab -->
        <div id="tab-bookings" class="tab-content">
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                <div class="p-4 border-b flex justify-between items-center">
                    <h2 class="font-bold text-emerald-900">รายการจองที่รอยืนยัน</h2>
                    <button onclick="refreshData()" class="text-xs bg-emerald-100 text-emerald-700 px-3 py-1 rounded">รีเฟรช</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-gray-50 text-gray-500 uppercase text-[10px] font-bold">
                            <tr>
                                <th class="p-4">วันที่เข้าพัก</th>
                                <th class="p-4">ผู้จอง</th>
                                <th class="p-4">ห้องพัก</th>
                                <th class="p-4">ยอดมัดจำ</th>
                                <th class="p-4">สลิป</th>
                                <th class="p-4">สถานะ</th>
                                <th class="p-4">จัดการ</th>
                            </tr>
                        </thead>
                        <tbody id="booking-table-body">
                            <!-- Injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="tab-settings" class="tab-content hidden space-y-4">
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded-xl shadow-sm">
                    <h3 class="font-bold mb-3">จัดการวันพิเศษ (มัดจำ 100%)</h3>
                    <!-- Form and list for special days -->
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm">
                    <h3 class="font-bold mb-3">จัดการโค้ดส่วนลด</h3>
                    <!-- Form and list for promo codes -->
                </div>
             </div>
        </div>
    </main>

    <script>
        const BACKEND_URL = "https://script.google.com/macros/s/AKfycbwb9VWt0rQYJ2dJa9jQKM23YRKsx-YReKnqJTiqGRbg26jEMtPP-RzxDbe_BahxUiSu5g/exec";

        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${tab}`).classList.remove('hidden');
        }

        async function refreshData() {
            const resp = await fetch(`${BACKEND_URL}?action=getAllBookings`);
            const bookings = await resp.json();
            
            const tbody = document.getElementById('booking-table-body');
            tbody.innerHTML = bookings.map(b => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="p-4 font-semibold">${b.checkin}</td>
                    <td class="p-4">
                        <div class="font-medium">${b.custName}</div>
                        <div class="text-xs text-gray-400">${b.custTel}</div>
                    </td>
                    <td class="p-4 text-xs">${b.rooms}</td>
                    <td class="p-4 font-bold text-emerald-700">฿${b.deposit}</td>
                    <td class="p-4">
                        <a href="${b.slipUrl}" target="_blank" class="text-blue-600 underline text-xs">ดูสลิป</a>
                    </td>
                    <td class="p-4">
                        <span class="px-2 py-1 rounded-full text-[10px] ${b.status === 'ยืนยันแล้ว' ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'}">
                            ${b.status}
                        </span>
                    </td>
                    <td class="p-4">
                        ${b.status !== 'ยืนยันแล้ว' ? `
                            <button onclick="approveBooking('${b.id}')" class="bg-emerald-600 text-white px-3 py-1 rounded text-xs">ยืนยัน</button>
                        ` : '-'}
                    </td>
                </tr>
            `).join('');
        }

        async function approveBooking(id) {
            if (!confirm('ยืนยันการตรวจสอบสลิปและส่งข้อความหาลูกค้า?')) return;
            const resp = await fetch(`${BACKEND_URL}?action=approveBooking&id=${id}`);
            const result = await resp.json();
            if (result.success) {
                alert('ยืนยันสำเร็จ!');
                refreshData();
            }
        }

        window.onload = refreshData;
    </script>
</body>
</html>
