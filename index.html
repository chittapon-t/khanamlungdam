<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å - ‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥ ‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #fcfaf7; }
        .camping-green { background-color: #1b4332; }
        .card-selected { 
            border: 2px solid #059669 !important; 
            background-color: #ecfdf5 !important;
            box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.1);
        }
        .bill-dashed { border-top: 2px dashed #cbd5e1; }
        .checkmark { display: none; }
        .card-selected .checkmark { display: block; }
    </style>
</head>
<body class="pb-32">
    <!-- Loading Overlay -->
    <div id="loading" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center">
        <div class="w-12 h-12 border-4 border-emerald-800 border-t-transparent rounded-full animate-spin"></div>
        <p class="mt-4 text-emerald-800 font-bold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>

    <!-- Header -->
    <header class="camping-green text-white p-6 rounded-b-3xl shadow-lg">
        <div class="flex justify-between items-start">
            <div>
                <h1 class="text-2xl font-bold uppercase">Khanam Lung Dam</h1>
                <p class="text-emerald-100 text-sm font-light italic">‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥ ‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á</p>
            </div>
            <img id="userImg" class="w-12 h-12 rounded-full border-2 border-white/30" src="https://via.placeholder.com/150" alt="Profile">
        </div>
    </header>

    <main class="p-4 max-w-md mx-auto space-y-6">
        
        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà -->
        <section class="bg-white p-5 rounded-2xl shadow-sm border border-emerald-50">
            <h2 class="font-bold text-emerald-900 mb-4 flex items-center italic">
                <span class="bg-emerald-100 p-1 rounded mr-2">üìÖ</span> ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å
            </h2>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-[10px] text-gray-400 font-bold uppercase block mb-1">Check-in</label>
                    <input type="date" id="checkin" class="w-full border rounded-xl p-3 text-sm outline-none focus:border-emerald-500" onchange="validateDates()">
                </div>
                <div>
                    <label class="text-[10px] text-gray-400 font-bold uppercase block mb-1">Check-out</label>
                    <input type="date" id="checkout" class="w-full border rounded-xl p-3 text-sm outline-none focus:border-emerald-500" onchange="validateDates()">
                </div>
            </div>
        </section>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å -->
        <section class="space-y-3">
            <h2 class="font-bold text-emerald-900 ml-2 italic text-lg">üè† ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô</h2>
            <div id="roomList" class="grid gap-3">
                <!-- JS Render -->
            </div>
        </section>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£ -->
        <section class="space-y-3">
            <h2 class="font-bold text-emerald-900 ml-2 italic">üç≤ ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°</h2>
            <div id="foodList" class="grid gap-2">
                <!-- JS Render -->
            </div>
        </section>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ç‡∏≠) -->
        <section class="bg-white p-5 rounded-2xl shadow-sm border border-emerald-100 space-y-3">
            <h2 class="font-bold text-emerald-900 flex items-center italic">
                <span class="bg-emerald-100 p-1 rounded mr-2">üë§</span> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á
            </h2>
            <div class="grid grid-cols-1 gap-3">
                <input type="text" id="custName" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="w-full border-b rounded-none p-3 text-sm focus:border-emerald-500 outline-none bg-transparent">
                <input type="tel" id="custTel" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ" class="w-full border-b rounded-none p-3 text-sm focus:border-emerald-500 outline-none bg-transparent">
            </div>
        </section>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏ö‡∏¥‡∏•‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ -->
        <section class="bg-white rounded-2xl shadow-xl border-2 border-slate-800 overflow-hidden relative">
            <div class="bg-slate-800 text-white p-3 text-center text-xs tracking-widest uppercase font-bold">Booking Invoice</div>
            <div class="p-5 space-y-4">
                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏ä‡∏¥‡πâ‡∏ô -->
                <div id="billItems" class="space-y-3 text-sm">
                    <p class="text-gray-400 text-center py-2 italic font-light">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
                </div>

                <!-- ‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î -->
                <div class="flex space-x-2 pt-2">
                    <input type="text" id="promoCode" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î" class="flex-1 border border-dashed border-gray-300 rounded-lg px-3 py-2 text-xs uppercase outline-none focus:border-emerald-500">
                    <button onclick="applyPromo()" class="bg-slate-100 text-slate-700 px-4 rounded-lg font-bold text-xs border border-slate-200">‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î</button>
                </div>

                <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç -->
                <div class="bill-dashed pt-4 space-y-2">
                    <div class="flex justify-between text-sm text-gray-600">
                        <span>‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</span>
                        <span id="sumRoomPrice">‡∏ø0</span>
                    </div>
                    <div class="flex justify-between text-sm text-red-500 font-bold" id="discountRow" style="display:none;">
                        <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (Discount)</span>
                        <span id="sumDiscount">-‡∏ø0</span>
                    </div>
                    <div class="flex justify-between text-sm text-gray-600">
                        <span>‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°</span>
                        <span id="sumFoodPrice">‡∏ø0</span>
                    </div>
                </div>

                <!-- ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ -->
                <div class="bill-dashed pt-4">
                    <div class="flex justify-between items-center">
                        <span class="font-bold text-slate-900 text-base uppercase">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                        <span id="finalTotal" class="font-bold text-xl text-slate-900">‡∏ø0</span>
                    </div>
                </div>

                <!-- ‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥ -->
                <div class="bg-emerald-50 p-4 rounded-xl border border-emerald-100 mt-2">
                    <div class="flex justify-between items-center text-emerald-900">
                        <div>
                            <span class="font-black text-xs uppercase">‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞</span>
                            <p class="text-[8px] text-emerald-600 italic">‡∏°‡∏±‡∏î‡∏à‡∏≥ 50% ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å + ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>
                        </div>
                        <span id="depositDisplay" class="text-2xl font-black">‡∏ø0</span>
                    </div>
                </div>
            </div>
            <!-- ‡∏£‡∏π‡∏ü‡∏±‡∏ô‡∏õ‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏á‡∏ö‡∏¥‡∏• -->
            <div class="h-1 w-full bg-slate-800" style="clip-path: polygon(0% 0%, 5% 100%, 10% 0%, 15% 100%, 20% 0%, 25% 100%, 30% 0%, 35% 100%, 40% 0%, 45% 100%, 50% 0%, 55% 100%, 60% 0%, 65% 100%, 70% 0%, 75% 100%, 80% 0%, 85% 100%, 90% 0%, 95% 100%, 100% 0%);"></div>
        </section>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 6: ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
        <section class="bg-white p-5 rounded-2xl shadow-sm border space-y-4">
            <div class="text-center space-y-2">
                <div class="flex justify-center">
                    <img id="qrImg" src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=0615924262" class="w-40 h-40 border-2 border-emerald-50 p-1 rounded-lg">
                </div>
                <div class="text-sm font-bold text-emerald-900 space-y-1 uppercase">
                    <p>PromptPay: 061-592-4262</p>
                    <p class="text-xs text-gray-500 font-normal">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ‡∏≠‡∏•‡∏á‡∏Å‡∏ï ‡∏ó‡∏ß‡∏µ‡∏ú‡πà‡∏≠‡∏á</p>
                </div>
            </div>
            
            <div class="space-y-2 bill-dashed pt-4">
                <label class="text-xs font-bold text-gray-500 uppercase">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
                <input type="file" id="slipInput" accept="image/*" class="w-full text-xs text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-emerald-50 file:text-emerald-700 active:scale-95 transition-all">
            </div>
        </section>

        <div class="flex items-start space-x-2 px-2 pb-10">
            <input type="checkbox" id="agreeTerms" class="w-4 h-4 mt-0.5 rounded text-emerald-600 focus:ring-0">
            <label for="agreeTerms" class="text-[10px] text-gray-400 leading-tight tracking-tighter">‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</label>
        </div>
    </main>

    <!-- Bottom Bar -->
    <div class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-md border-t p-4 flex justify-center max-w-md mx-auto z-40">
        <button onclick="submitBooking()" class="w-full bg-emerald-800 text-white py-4 rounded-2xl font-bold shadow-xl active:scale-95 transition-all flex justify-center items-center">
            <span>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</span>
            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>
        </button>
    </div>

    <script>
        const LIFF_ID = '2008863563-tuai5kaC';
        
        const ROOM_DATA = [
            { id: 'R1', name: '‡πÇ‡∏Æ‡∏°‡∏™‡πÄ‡∏ï‡∏¢‡πå‡∏´‡∏ô‡∏≥‡πÇ‡∏õ', minPax: 4, maxPax: 8, basePrice: 1600, tieredPrice: { '4-5': 1600, '6-8': 2200 } },
            { id: 'R2', name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏±‡∏Å‡∏£‡∏¥‡∏°‡∏ô‡πâ‡∏≥ 1', minPax: 1, maxPax: 3, basePrice: 1400, tieredPrice: { '1-2': 1400, '3': 1750 } },
            { id: 'R3', name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏±‡∏Å‡∏£‡∏¥‡∏°‡∏ô‡πâ‡∏≥ 2', minPax: 1, maxPax: 3, basePrice: 1400, tieredPrice: { '1-2': 1400, '3': 1750 } },
            { id: 'R4', name: '‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏Å‡∏£‡∏∞‡πÇ‡∏à‡∏° 1', minPax: 1, maxPax: 4, basePrice: 1200, tieredPrice: { '1-2': 1200, '3-4': 1550 } },
            { id: 'R5', name: '‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏Å‡∏£‡∏∞‡πÇ‡∏à‡∏° 2', minPax: 1, maxPax: 4, basePrice: 1200, tieredPrice: { '1-2': 1200, '3-4': 1550 } },
            { id: 'R6', name: '‡πÄ‡∏ä‡πà‡∏≤‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏™‡∏ô‡∏≤‡∏° K1', minPax: 1, maxPax: 2, basePrice: 700 },
            { id: 'R7', name: '‡πÄ‡∏ä‡πà‡∏≤‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏™‡∏ô‡∏≤‡∏° K2', minPax: 1, maxPax: 2, basePrice: 700 },
            { id: 'R8', name: '‡∏•‡∏≤‡∏ô‡∏Å‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå', minPax: 1, maxPax: 20, pricePerPerson: 150 }
        ];

        const FOOD_DATA = [
            { id: 'F1', name: '‡∏ä‡∏∏‡∏î‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞‡∏•‡∏∏‡∏á‡∏î‡∏≥', price: 390 },
            { id: 'F2', name: '‡∏ä‡∏∏‡∏î‡πÑ‡∏Å‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏∞‡∏•‡∏∏‡∏á‡∏î‡∏≥', price: 390 },
            { id: 'F3', name: '‡∏ä‡∏∏‡∏î‡∏ä‡∏≤‡∏ö‡∏π‡∏´‡∏°‡∏π‡∏•‡∏∏‡∏á‡∏î‡∏≥', price: 390 },
            { id: 'F4', name: '‡∏ä‡∏∏‡∏î‡∏ä‡∏≤‡∏ö‡∏π‡πÑ‡∏Å‡πà‡∏•‡∏∏‡∏á‡∏î‡∏≥', price: 390 },
            { id: 'F5', name: '‡πÄ‡∏ã‡πá‡∏ï‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô', price: 390 }
        ];

        let state = {
            profile: {},
            selectedRooms: {},
            selectedFoods: {},
            discount: 0,
            isSpecialDate: false
        };

        async function init() {
            try {
                await liff.init({ liffId: LIFF_ID });
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    const profile = await liff.getProfile();
                    state.profile = profile;
                    document.getElementById('userImg').src = profile.pictureUrl;
                    renderRooms();
                    renderFoods();
                    document.getElementById('loading').style.display = 'none';
                }
            } catch (err) { console.error(err); }
        }

        function renderRooms() {
            const container = document.getElementById('roomList');
            container.innerHTML = ROOM_DATA.map(room => `
                <div id="card-${room.id}" class="bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center transition-all border-2 border-transparent">
                    <div class="flex-1">
                        <div class="flex items-center">
                            <h3 class="text-sm font-bold text-emerald-900 leading-tight">${room.name}</h3>
                            <div class="checkmark ml-2">
                                <svg class="w-5 h-5 text-emerald-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 mt-2">
                            <button onclick="updateRoomPax('${room.id}', -1)" class="w-8 h-8 bg-gray-50 text-emerald-800 rounded-lg font-bold shadow-sm border border-emerald-100 active:bg-emerald-100 transition-colors">-</button>
                            <span id="room-pax-${room.id}" class="w-6 text-center font-bold text-base">0</span>
                            <button onclick="updateRoomPax('${room.id}', 1)" class="w-8 h-8 bg-gray-50 text-emerald-800 rounded-lg font-bold shadow-sm border border-emerald-100 active:bg-emerald-100 transition-colors">+</button>
                            <span class="text-[11px] text-gray-500 font-bold ml-1 italic">‡∏ó‡πà‡∏≤‡∏ô</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] text-gray-400 font-semibold mb-1" id="room-info-${room.id}">${room.pricePerPerson ? '‡∏ø150/‡∏Ñ‡∏ô' : '‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô'}</p>
                        <p class="font-bold text-lg text-emerald-700" id="room-price-${room.id}">‡∏ø0</p>
                    </div>
                </div>
            `).join('');
        }

        function renderFoods() {
            const container = document.getElementById('foodList');
            container.innerHTML = FOOD_DATA.map(food => `
                <div class="bg-white p-3 rounded-xl border border-emerald-50 flex justify-between items-center shadow-sm">
                    <span class="text-xs font-bold text-slate-600 italic">${food.name}</span>
                    <div class="flex items-center space-x-3">
                        <span class="text-[10px] text-emerald-600 font-bold bg-emerald-50 px-2 py-1 rounded">‡∏ø${food.price}</span>
                        <div class="flex items-center space-x-2 bg-gray-100 rounded-lg px-1 py-1">
                            <button onclick="updateFoodQty('${food.id}', -1)" class="w-5 h-5 flex items-center justify-center bg-white rounded shadow-sm text-xs font-bold text-emerald-700">-</button>
                            <span id="food-qty-${food.id}" class="text-xs font-bold w-4 text-center">0</span>
                            <button onclick="updateFoodQty('${food.id}', 1)" class="w-5 h-5 flex items-center justify-center bg-white rounded shadow-sm text-xs font-bold text-emerald-700">+</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateRoomPax(id, change) {
            const room = ROOM_DATA.find(r => r.id === id);
            let current = state.selectedRooms[id] || 0;
            current = Math.max(0, Math.min(room.maxPax, current + change));
            
            const card = document.getElementById(`card-${id}`);
            if (current > 0) {
                state.selectedRooms[id] = current;
                card.classList.add('card-selected');
            } else {
                delete state.selectedRooms[id];
                card.classList.remove('card-selected');
            }
            document.getElementById(`room-pax-${id}`).innerText = current;
            calculateAll();
        }

        function updateFoodQty(id, change) {
            let current = state.selectedFoods[id] || 0;
            current = Math.max(0, current + change);
            if (current > 0) state.selectedFoods[id] = current;
            else delete state.selectedFoods[id];
            document.getElementById(`food-qty-${id}`).innerText = current;
            calculateAll();
        }

        function calculateAll() {
            let roomTotal = 0;
            let foodTotal = 0;
            const billItemsContainer = document.getElementById('billItems');
            let billHtml = '';

            // Calculate Room Total
            for (let id in state.selectedRooms) {
                const room = ROOM_DATA.find(r => r.id === id);
                const pax = state.selectedRooms[id];
                let price = 0;
                if (room.pricePerPerson) {
                    price = pax * room.pricePerPerson;
                } else if (room.tieredPrice) {
                    for (let range in room.tieredPrice) {
                        const [min, max] = range.includes('-') ? range.split('-').map(Number) : [Number(range), Number(range)];
                        if (max) { if (pax >= min && pax <= max) price = room.tieredPrice[range]; }
                        else { if (pax >= min) price = room.tieredPrice[range]; }
                    }
                    if (price === 0) price = room.basePrice; 
                } else {
                    price = room.basePrice;
                }
                roomTotal += price;
                document.getElementById(`room-price-${id}`).innerText = `‡∏ø${price.toLocaleString()}`;
                billHtml += `
                    <div class="flex justify-between items-start">
                        <span class="text-slate-600">üè† ${room.name} <span class="text-[9px] font-bold bg-slate-100 px-1 rounded ml-1">${pax} ‡∏ó‡πà‡∏≤‡∏ô</span></span>
                        <span class="font-bold text-slate-800 underline decoration-slate-200 decoration-2">‡∏ø${price.toLocaleString()}</span>
                    </div>
                `;
            }

            // Calculate Food Total
            for (let id in state.selectedFoods) {
                const food = FOOD_DATA.find(f => f.id === id);
                const qty = state.selectedFoods[id];
                const cost = food.price * qty;
                foodTotal += cost;
                billHtml += `
                    <div class="flex justify-between">
                        <span class="text-slate-600 italic">üç≤ ${food.name} <span class="text-gray-400">x${qty}</span></span>
                        <span class="font-bold text-slate-800">‡∏ø${cost.toLocaleString()}</span>
                    </div>
                `;
            }

            if (!billHtml) billHtml = '<p class="text-gray-400 text-center py-2 italic font-light">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>';
            billItemsContainer.innerHTML = billHtml;

            // Apply Discount
            const discountAmount = state.discount;
            const discountRow = document.getElementById('discountRow');
            if (discountAmount > 0) {
                discountRow.style.display = 'flex';
                document.getElementById('sumDiscount').innerText = `-‡∏ø${discountAmount.toLocaleString()}`;
            } else {
                discountRow.style.display = 'none';
            }

            // Calculations
            const roomAfterDisc = Math.max(0, roomTotal - discountAmount);
            const depositRate = state.isSpecialDate ? 1.0 : 0.5;
            const depositAmount = (roomAfterDisc * depositRate) + foodTotal;
            const netTotal = (roomTotal + foodTotal) - discountAmount;

            // UI Update
            document.getElementById('sumRoomPrice').innerText = `‡∏ø${roomTotal.toLocaleString()}`;
            document.getElementById('sumFoodPrice').innerText = `‡∏ø${foodTotal.toLocaleString()}`;
            document.getElementById('finalTotal').innerText = `‡∏ø${netTotal.toLocaleString()}`;
            document.getElementById('depositDisplay').innerText = `‡∏ø${depositAmount.toLocaleString()}`;
            
            // Dynamic QR Code Update
            document.getElementById('qrImg').src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=0615924262&amount=${depositAmount}`;
        }

        function applyPromo() {
            const code = document.getElementById('promoCode').value.toUpperCase().trim();
            if (code === 'LUNGDAM100') {
                state.discount = 100;
                alert('üéâ ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 100 ‡∏ö‡∏≤‡∏ó‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            } else if (code === 'WELCOME') {
                state.discount = 50;
                alert('üéâ ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 50 ‡∏ö‡∏≤‡∏ó‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            } else {
                state.discount = 0;
                alert('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏');
            }
            calculateAll();
        }

        function validateDates() {
            const checkin = document.getElementById('checkin').value;
            const checkout = document.getElementById('checkout').value;
            if (checkin && checkout) {
                const start = new Date(checkin);
                const today = new Date();
                today.setHours(0,0,0,0);
                if (start <= today) {
                    alert('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏à‡∏≠‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ß‡∏±‡∏ô');
                    document.getElementById('checkin').value = '';
                }
                calculateAll();
            }
        }

        function submitBooking() {
            const name = document.getElementById('custName').value;
            const tel = document.getElementById('custTel').value;
            if (!name || !tel) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô');
            if (Object.keys(state.selectedRooms).length === 0) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
            if (!document.getElementById('agreeTerms').checked) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á');
            
            // Success Action
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó');
        }

        window.onload = init;
    </script>
</body>
</html>
