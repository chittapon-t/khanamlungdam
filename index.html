<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å - ‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥ ‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #fcfaf7; }
        .camping-green { background-color: #1b4332; }
        .card-selected { border: 2px solid #1b4332; background-color: #f0fdf4; }
        .bill-dashed { border-top: 2px dashed #e5e7eb; }
    </style>
</head>
<body class="pb-32">
    <!-- Loading Overlay -->
    <div id="loading" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center">
        <div class="w-12 h-12 border-4 border-emerald-800 border-t-transparent rounded-full animate-spin"></div>
        <p class="mt-4 text-emerald-800 font-bold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>

    <!-- Header -->
    <header class="camping-green text-white p-6 rounded-b-3xl shadow-lg">
        <div class="flex justify-between items-start">
            <div>
                <h1 class="text-2xl font-bold">‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥ ‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á</h1>
                <p class="text-emerald-100 text-sm">‡πÉ‡∏ö‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
            </div>
            <img id="userImg" class="w-12 h-12 rounded-full border-2 border-white/30" src="https://via.placeholder.com/150" alt="Profile">
        </div>
    </header>

    <main class="p-4 max-w-md mx-auto space-y-6">
        
        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ -->
        <section class="bg-white p-5 rounded-2xl shadow-sm border border-emerald-50 space-y-3">
            <h2 class="font-bold text-emerald-900 flex items-center italic">
                <span class="bg-emerald-100 p-1 rounded mr-2">üë§</span> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
            </h2>
            <div class="grid grid-cols-1 gap-3">
                <input type="text" id="custName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á" class="w-full border rounded-xl p-3 text-sm focus:ring-2 focus:ring-emerald-500 outline-none">
                <input type="tel" id="custTel" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" class="w-full border rounded-xl p-3 text-sm focus:ring-2 focus:ring-emerald-500 outline-none">
            </div>
        </section>

        <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà -->
        <section class="bg-white p-5 rounded-2xl shadow-sm border border-emerald-50">
            <h2 class="font-bold text-emerald-900 mb-4 flex items-center italic">
                <span class="bg-emerald-100 p-1 rounded mr-2">üìÖ</span> ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å
            </h2>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-xs text-gray-500 block mb-1">‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô</label>
                    <input type="date" id="checkin" class="w-full border rounded-xl p-3 text-sm outline-none" onchange="validateDates()">
                </div>
                <div>
                    <label class="text-xs text-gray-500 block mb-1">‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå</label>
                    <input type="date" id="checkout" class="w-full border rounded-xl p-3 text-sm outline-none" onchange="validateDates()">
                </div>
            </div>
        </section>

        <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å -->
        <section class="space-y-3">
            <h2 class="font-bold text-emerald-900 ml-2 italic">üè† ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</h2>
            <div id="roomList" class="grid gap-3"></div>
        </section>

        <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£ -->
        <section class="space-y-3">
            <h2 class="font-bold text-emerald-900 ml-2 italic">üç≤ ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>
            <div id="foodList" class="grid gap-2"></div>
        </section>

        <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏ö‡∏¥‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î -->
        <section class="bg-white rounded-2xl shadow-lg border-2 border-emerald-800 overflow-hidden">
            <div class="bg-emerald-800 text-white p-3 text-center font-bold">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</div>
            <div class="p-5 space-y-4">
                <div id="billItems" class="space-y-2 text-sm">
                    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
                    <p class="text-gray-400 text-center py-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
                </div>

                <div class="bill-dashed pt-4 space-y-2">
                    <div class="flex justify-between text-sm">
                        <span>‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</span>
                        <span id="sumRoomPrice">‡∏ø0</span>
                    </div>
                    <div class="flex justify-between text-sm text-red-600 font-bold">
                        <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</span>
                        <span id="sumDiscount">-‡∏ø0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
                        <span id="sumFoodPrice">‡∏ø0</span>
                    </div>
                </div>

                <div class="bill-dashed pt-4">
                    <div class="flex justify-between items-center">
                        <span class="font-bold text-emerald-900 text-lg uppercase">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                        <span id="finalTotal" class="font-bold text-xl text-emerald-900">‡∏ø0</span>
                    </div>
                </div>

                <div class="bg-red-50 p-4 rounded-xl border border-red-100 mt-2">
                    <div class="flex justify-between items-center text-red-800">
                        <span class="font-bold text-sm">‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞</span>
                        <span id="depositDisplay" class="text-2xl font-black">‡∏ø0</span>
                    </div>
                    <p class="text-[9px] text-red-600 mt-1 italic leading-tight text-right">
                        ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å: (‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å - ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î) x 50% + ‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£
                    </p>
                </div>
            </div>
        </section>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î & ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
        <section class="space-y-4">
            <div class="bg-white p-5 rounded-2xl shadow-sm flex space-x-2 border">
                <input type="text" id="promoCode" placeholder="‡πÉ‡∏™‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î" class="flex-1 border rounded-xl p-3 text-sm uppercase outline-none focus:ring-1 focus:ring-emerald-500">
                <button onclick="applyPromo()" class="bg-emerald-800 text-white px-4 rounded-xl font-bold text-sm">‡∏ï‡∏Å‡∏•‡∏á</button>
            </div>

            <div class="bg-white p-5 rounded-2xl shadow-sm border space-y-4">
                <div class="text-center space-y-2">
                    <div class="flex justify-center">
                        <img id="qrImg" src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=0615924262" class="w-40 h-40 border-2 border-emerald-50 p-1 rounded-lg">
                    </div>
                    <p class="text-sm font-bold text-emerald-900 leading-tight uppercase">
                        ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå: 061-592-4262<br>
                        ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ‡∏≠‡∏•‡∏á‡∏Å‡∏ï ‡∏ó‡∏ß‡∏µ‡∏ú‡πà‡∏≠‡∏á
                    </p>
                </div>
                
                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-500">‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏™‡∏•‡∏¥‡∏õ)</label>
                    <input type="file" id="slipInput" accept="image/*" class="w-full text-xs text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-emerald-50 file:text-emerald-700">
                </div>
            </div>
        </section>

        <div class="flex items-center space-x-2 px-2">
            <input type="checkbox" id="agreeTerms" class="w-4 h-4 rounded text-emerald-600 focus:ring-0">
            <label for="agreeTerms" class="text-[10px] text-gray-400">‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏¢‡∏¥‡∏ô‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å</label>
        </div>
    </main>

    <!-- Bottom Bar -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 flex justify-center max-w-md mx-auto z-40">
        <button onclick="submitBooking()" class="w-full bg-emerald-800 text-white py-4 rounded-2xl font-bold shadow-xl active:scale-95 transition-all flex justify-center items-center">
            <span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>
        </button>
    </div>

    <script>
        const LIFF_ID = '2008863563-tuai5kaC';
        
        const ROOM_DATA = [
            { id: 'R1', name: '‡πÇ‡∏Æ‡∏°‡∏™‡πÄ‡∏ï‡∏¢‡πå‡∏´‡∏ô‡∏≥‡πÇ‡∏õ', minPax: 4, maxPax: 8, basePrice: 1600, tieredPrice: { '4-5': 1600, '6-8': 2200 } },
            { id: 'R2', name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏±‡∏Å‡∏£‡∏¥‡∏°‡∏ô‡πâ‡∏≥ 1', minPax: 1, maxPax: 3, basePrice: 1400, tieredPrice: { '1-2': 1400, '3': 1750 } },
            { id: 'R3', name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏±‡∏Å‡∏£‡∏¥‡∏°‡∏ô‡πâ‡∏≥ 2', minPax: 1, maxPax: 3, basePrice: 1400, tieredPrice: { '1-2': 1400, '3': 1750 } },
            { id: 'R4', name: '‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏Å‡∏£‡∏∞‡πÇ‡∏à‡∏° 1', minPax: 1, maxPax: 4, basePrice: 1200, tieredPrice: { '1-2': 1200, '3-4': 1550 } },
            { id: 'R5', name: '‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏Å‡∏£‡∏∞‡πÇ‡∏à‡∏° 2', minPax: 1, maxPax: 4, basePrice: 1200, tieredPrice: { '1-2': 1200, '3-4': 1550 } },
            { id: 'R6', name: '‡πÄ‡∏ä‡πà‡∏≤‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏™‡∏ô‡∏≤‡∏° K1', minPax: 1, maxPax: 2, basePrice: 700 },
            { id: 'R7', name: '‡πÄ‡∏ä‡πà‡∏≤‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏™‡∏ô‡∏≤‡∏° K2', minPax: 1, maxPax: 2, basePrice: 700 },
            { id: 'R8', name: '‡∏•‡∏≤‡∏ô‡∏Å‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå', minPax: 1, maxPax: 20, pricePerPerson: 150 }
        ];

        const FOOD_DATA = [
            { id: 'F1', name: '‡∏ä‡∏∏‡∏î‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞‡∏•‡∏∏‡∏á‡∏î‡∏≥', price: 390 },
            { id: 'F2', name: '‡∏ä‡∏∏‡∏î‡πÑ‡∏Å‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏∞‡∏•‡∏∏‡∏á‡∏î‡∏≥', price: 390 },
            { id: 'F3', name: '‡∏ä‡∏∏‡∏î‡∏ä‡∏≤‡∏ö‡∏π‡∏´‡∏°‡∏π‡∏•‡∏∏‡∏á‡∏î‡∏≥', price: 390 },
            { id: 'F4', name: '‡∏ä‡∏∏‡∏î‡∏ä‡∏≤‡∏ö‡∏π‡πÑ‡∏Å‡πà‡∏•‡∏∏‡∏á‡∏î‡∏≥', price: 390 },
            { id: 'F5', name: '‡πÄ‡∏ã‡πá‡∏ï‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô', price: 390 }
        ];

        let state = {
            profile: {},
            selectedRooms: {},
            selectedFoods: {},
            discount: 0,
            isSpecialDate: false
        };

        async function init() {
            try {
                await liff.init({ liffId: LIFF_ID });
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    const profile = await liff.getProfile();
                    state.profile = profile;
                    document.getElementById('userImg').src = profile.pictureUrl;
                    renderRooms();
                    renderFoods();
                    document.getElementById('loading').style.display = 'none';
                }
            } catch (err) { console.error(err); }
        }

        function renderRooms() {
            const container = document.getElementById('roomList');
            container.innerHTML = ROOM_DATA.map(room => `
                <div id="card-${room.id}" class="bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center transition-all border border-transparent">
                    <div class="flex-1">
                        <h3 class="text-sm font-bold text-emerald-900 leading-tight">${room.name}</h3>
                        <div class="flex items-center space-x-2 mt-2">
                            <button onclick="updateRoomPax('${room.id}', -1)" class="w-7 h-7 bg-emerald-50 text-emerald-800 rounded-lg font-bold shadow-sm border border-emerald-100">-</button>
                            <span id="room-pax-${room.id}" class="w-6 text-center font-bold text-sm">0</span>
                            <button onclick="updateRoomPax('${room.id}', 1)" class="w-7 h-7 bg-emerald-50 text-emerald-800 rounded-lg font-bold shadow-sm border border-emerald-100">+</button>
                            <span class="text-[10px] text-gray-400">‡∏ó‡πà‡∏≤‡∏ô</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-gray-400" id="room-info-${room.id}">${room.pricePerPerson ? '150/‡∏Ñ‡∏ô' : '‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô'}</p>
                        <p class="font-bold text-emerald-700" id="room-price-${room.id}">‡∏ø0</p>
                    </div>
                </div>
            `).join('');
        }

        function renderFoods() {
            const container = document.getElementById('foodList');
            container.innerHTML = FOOD_DATA.map(food => `
                <div class="bg-white p-3 rounded-xl border border-emerald-50 flex justify-between items-center shadow-sm">
                    <span class="text-xs font-bold text-gray-600">${food.name}</span>
                    <div class="flex items-center space-x-3">
                        <span class="text-[10px] text-emerald-600 font-bold">‡∏ø${food.price}</span>
                        <div class="flex items-center space-x-2 bg-gray-50 rounded-lg px-1 py-1">
                            <button onclick="updateFoodQty('${food.id}', -1)" class="w-5 h-5 flex items-center justify-center bg-white rounded border text-xs font-bold text-emerald-700">-</button>
                            <span id="food-qty-${food.id}" class="text-xs font-bold w-3 text-center">0</span>
                            <button onclick="updateFoodQty('${food.id}', 1)" class="w-5 h-5 flex items-center justify-center bg-white rounded border text-xs font-bold text-emerald-700">+</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateRoomPax(id, change) {
            const room = ROOM_DATA.find(r => r.id === id);
            let current = state.selectedRooms[id] || 0;
            current = Math.max(0, Math.min(room.maxPax, current + change));
            
            const card = document.getElementById(`card-${id}`);
            if (current > 0) {
                state.selectedRooms[id] = current;
                card.classList.add('card-selected');
            } else {
                delete state.selectedRooms[id];
                card.classList.remove('card-selected');
            }
            document.getElementById(`room-pax-${id}`).innerText = current;
            calculateAll();
        }

        function updateFoodQty(id, change) {
            let current = state.selectedFoods[id] || 0;
            current = Math.max(0, current + change);
            if (current > 0) state.selectedFoods[id] = current;
            else delete state.selectedFoods[id];
            document.getElementById(`food-qty-${id}`).innerText = current;
            calculateAll();
        }

        function calculateAll() {
            let roomTotal = 0;
            let foodTotal = 0;
            const billItemsContainer = document.getElementById('billItems');
            let billHtml = '';

            // Calc Rooms
            for (let id in state.selectedRooms) {
                const room = ROOM_DATA.find(r => r.id === id);
                const pax = state.selectedRooms[id];
                let price = 0;

                if (room.pricePerPerson) {
                    price = pax * room.pricePerPerson;
                } else if (room.tieredPrice) {
                    for (let range in room.tieredPrice) {
                        const [min, max] = range.includes('-') ? range.split('-').map(Number) : [Number(range), Number(range)];
                        if (max) { if (pax >= min && pax <= max) price = room.tieredPrice[range]; }
                        else { if (pax >= min) price = room.tieredPrice[range]; }
                    }
                    if (price === 0) price = room.basePrice; 
                } else {
                    price = room.basePrice;
                }
                roomTotal += price;
                document.getElementById(`room-price-${id}`).innerText = `‡∏ø${price.toLocaleString()}`;
                billHtml += `
                    <div class="flex justify-between items-start">
                        <span class="text-gray-600 leading-tight">üè† ${room.name}<br><small class="text-gray-400 font-bold ml-4">(${pax} ‡∏ó‡πà‡∏≤‡∏ô)</small></span>
                        <span class="font-bold">‡∏ø${price.toLocaleString()}</span>
                    </div>
                `;
            }

            // Calc Foods
            for (let id in state.selectedFoods) {
                const food = FOOD_DATA.find(f => f.id === id);
                const qty = state.selectedFoods[id];
                const cost = food.price * qty;
                foodTotal += cost;
                billHtml += `
                    <div class="flex justify-between">
                        <span class="text-gray-600">üç≤ ${food.name} x${qty}</span>
                        <span class="font-bold">‡∏ø${cost.toLocaleString()}</span>
                    </div>
                `;
            }

            if (!billHtml) billHtml = '<p class="text-gray-400 text-center py-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>';
            billItemsContainer.innerHTML = billHtml;

            // ‡∏ö‡∏¥‡∏•‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡πâ‡∏≤‡∏¢
            const roomAfterDisc = Math.max(0, roomTotal - state.discount);
            const depositRate = state.isSpecialDate ? 1.0 : 0.5;
            
            // ‡∏™‡∏π‡∏ï‡∏£: (‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å - ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î) x 50% + ‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£
            const depositAmount = (roomAfterDisc * depositRate) + foodTotal;
            const netTotal = (roomTotal + foodTotal) - state.discount;

            document.getElementById('sumRoomPrice').innerText = `‡∏ø${roomTotal.toLocaleString()}`;
            document.getElementById('sumDiscount').innerText = `-‡∏ø${state.discount.toLocaleString()}`;
            document.getElementById('sumFoodPrice').innerText = `‡∏ø${foodTotal.toLocaleString()}`;
            document.getElementById('finalTotal').innerText = `‡∏ø${netTotal.toLocaleString()}`;
            document.getElementById('depositDisplay').innerText = `‡∏ø${depositAmount.toLocaleString()}`;
            
            // Update QR
            document.getElementById('qrImg').src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=0615924262&amount=${depositAmount}`;
        }

        function validateDates() {
            const checkin = document.getElementById('checkin').value;
            const checkout = document.getElementById('checkout').value;
            if (checkin && checkout) {
                const start = new Date(checkin);
                const today = new Date();
                today.setHours(0,0,0,0);
                if (start <= today) {
                    alert('‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                    document.getElementById('checkin').value = '';
                }
                calculateAll();
            }
        }

        function applyPromo() {
            const code = document.getElementById('promoCode').value.toUpperCase();
            if (code === 'LUNGDAM100') {
                state.discount = 100;
                alert('‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏•‡∏î 100 ‡∏ö‡∏≤‡∏ó');
            } else {
                state.discount = 0;
                alert('‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            }
            calculateAll();
        }

        function submitBooking() {
            const name = document.getElementById('custName').value;
            const tel = document.getElementById('custTel').value;
            if (!name || !tel) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠');
            if (Object.keys(state.selectedRooms).length === 0) return alert('‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å');
            if (!document.getElementById('agreeTerms').checked) return alert('‡πÇ‡∏õ‡∏£‡∏î‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç');
            alert('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô...');
        }

        window.onload = init;
    </script>
</body>
</html>
